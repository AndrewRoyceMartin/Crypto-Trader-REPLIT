<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Trading Dashboard - Unified View</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    
    <!-- Clean Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style_clean.css') }}?v={{ cache_version|default(0) }}">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                <i class="fas fa-chart-line me-2"></i>
                Crypto Trading Dashboard
            </a>
            
            <!-- Quick Navigation Pills -->
            <div class="navbar-nav me-auto">
                <div class="nav-pills-container d-flex">
                    <a class="nav-link active" href="#overview" onclick="scrollToSection('overview')">
                        <i class="fas fa-tachometer-alt me-1"></i> Overview
                    </a>
                    <a class="nav-link" href="#portfolio" onclick="scrollToSection('portfolio')">
                        <i class="fas fa-wallet me-1"></i> Portfolio
                    </a>
                    <a class="nav-link" href="#performance" onclick="scrollToSection('performance')">
                        <i class="fas fa-chart-bar me-1"></i> Performance
                    </a>
                    <a class="nav-link" href="#holdings" onclick="scrollToSection('holdings')">
                        <i class="fas fa-coins me-1"></i> Holdings
                    </a>
                    <a class="nav-link" href="#trades" onclick="scrollToSection('trades')">
                        <i class="fas fa-exchange-alt me-1"></i> Trades
                    </a>
                </div>
            </div>
            
            <!-- Right side controls - Primary Actions -->
            <div class="navbar-nav ms-auto">
                <div class="nav-item d-flex align-items-center flex-wrap">
                    <!-- Currency Selector -->
                    <div class="me-3 mb-1 mb-lg-0">
                        <label for="currency-selector" class="visually-hidden">Currency</label>
                        <select class="form-select form-select-sm currency-select" id="currency-selector" onchange="changeCurrency()">
                            <option value="USD" selected>USD ($)</option>
                            <option value="AUD">AUD ($)</option>
                            <option value="EUR">EUR (€)</option>
                            <option value="GBP">GBP (£)</option>
                        </select>
                    </div>
                    
                    <!-- Sync Test Button -->
                    <a class="btn btn-outline-info btn-sm me-2 mb-1 mb-lg-0" href="{{ url_for('test_sync_data') }}" target="_blank">
                        <i class="fas fa-sync-alt me-1"></i> 
                        <span class="d-none d-md-inline">Sync Test</span>
                        <span class="d-md-none">Sync</span>
                    </a>
                    
                    <!-- ATO Export Button -->
                    <button class="btn btn-outline-success btn-sm me-2 mb-1 mb-lg-0" onclick="exportATOTax()" title="Export ATO-compliant tax records">
                        <i class="fas fa-file-invoice-dollar me-1"></i> 
                        <span class="d-none d-md-inline">ATO Export</span>
                        <span class="d-md-none">ATO</span>
                    </button>
                    
                    <!-- Take Profit Button -->
                    <button class="btn btn-outline-warning btn-sm me-2 mb-1 mb-lg-0" id="take-profit-btn" onclick="executeTakeProfit()" title="Execute take profit trades for positions above 2% profit">
                        <i class="fas fa-money-bill-wave me-1"></i> 
                        <span class="d-none d-md-inline">Take Profit</span>
                        <span class="d-md-none">Profit</span>
                    </button>
                    
                    <!-- Trading Controls Dropdown -->
                    <div class="btn-group">
                        <button class="btn btn-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" title="Manual trading controls">
                            <i class="fas fa-exchange-alt me-1"></i>
                            <span class="d-none d-md-inline">Trade</span>
                            <span class="d-md-none">₿</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><h6 class="dropdown-header"><i class="fas fa-coins me-1"></i> Manual Trading</h6></li>
                            <li><button class="dropdown-item" onclick="showBuyDialog()">
                                <i class="fas fa-arrow-up text-success me-2"></i> Buy Position
                            </button></li>
                            <li><button class="dropdown-item" onclick="showSellDialog()">
                                <i class="fas fa-arrow-down text-danger me-2"></i> Sell Position
                            </button></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header"><i class="fas fa-robot me-1"></i> Automated</h6></li>
                            <li><button class="dropdown-item" onclick="toggleBot()">
                                <i class="fas fa-play-circle text-info me-2"></i> <span id="bot-toggle-text">Start Bot</span>
                            </button></li>
                            <li><button class="dropdown-item" onclick="executeRebalance()">
                                <i class="fas fa-balance-scale text-warning me-2"></i> Rebalance Portfolio
                            </button></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid py-3">
        
        <!-- SECTION 1: OVERVIEW DASHBOARD -->
        <section id="overview" class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-tachometer-alt me-2 text-primary"></i>Quick Overview</h2>
                <div class="d-flex align-items-center">
                    <span class="badge bg-success me-2">
                        <i class="fas fa-wifi me-1"></i>
                        <span id="overview-connection">Connected</span>
                    </span>
                    <small class="text-muted">
                        Last Update: <span id="overview-last-update">—</span>
                    </small>
                </div>
            </div>

            <!-- KPI Cards Row -->
            <div class="row text-center mb-4 g-2">
                <div class="col-6 col-md-2">
                    <div class="kpi-card bg-primary text-white shadow-sm">
                        <div class="label">Total Equity</div>
                        <div id="kpi-total-equity" class="value">$0.00</div>
                    </div>
                </div>
                <div class="col-6 col-md-2">
                    <div class="kpi-card bg-info text-white shadow-sm">
                        <div class="label">Today P&L</div>
                        <div id="kpi-daily-pnl" class="value">$0.00</div>
                    </div>
                </div>
                <div class="col-6 col-md-2">
                    <div class="kpi-card bg-success text-white shadow-sm">
                        <div class="label">Unrealized P&L</div>
                        <div id="kpi-unrealized-pnl" class="value">$0.00</div>
                    </div>
                </div>
                <div class="col-6 col-md-2">
                    <div class="kpi-card bg-warning text-dark shadow-sm">
                        <div class="label">Cash</div>
                        <div id="kpi-cash" class="value">$0.00</div>
                    </div>
                </div>
                <div class="col-6 col-md-2">
                    <div class="kpi-card bg-secondary text-white shadow-sm">
                        <div class="label">Exposure</div>
                        <div id="kpi-exposure" class="value">—</div>
                    </div>
                </div>
                <div class="col-6 col-md-2">
                    <div class="kpi-card bg-dark text-white shadow-sm">
                        <div class="label">Win Rate (30d)</div>
                        <div id="kpi-win-rate" class="value">—</div>
                    </div>
                </div>
            </div>

            <!-- Risk & Status Strip -->
            <div class="row align-items-center mb-3 g-3">
                <div class="col-12 col-lg-6">
                    <div class="small text-muted d-flex justify-content-between">
                        <span>Daily Loss Cap</span>
                        <span id="loss-cap-text">—</span>
                    </div>
                    <div class="progress progress-thin">
                        <div id="loss-cap-bar" class="progress-bar progress-bar-zero" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
                <div class="col-12 col-lg-6 text-end small">
                    <span class="me-3">
                        <i class="fas fa-server text-info me-1"></i>
                        Server Uptime: <span id="system-uptime" class="text-info">0s</span>
                    </span>
                    <span>
                        <i class="fas fa-exchange-alt text-success me-1"></i>
                        OKX API: <span id="okx-connection-text" class="text-success">Connected</span>
                    </span>
                </div>
            </div>

            <!-- Quick Trading & Charts Row -->
            <div class="row g-3">
                <div class="col-md-3">
                    <div class="chart-card">
                        <div class="chart-card-body">
                            <canvas id="portfolioChart" height="120"></canvas>
                        </div>
                        <div class="chart-card-footer">Portfolio Value Trend</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="chart-card">
                        <div class="chart-card-body">
                            <canvas id="pnlChart" height="120"></canvas>
                        </div>
                        <div class="chart-card-footer">Daily P&L</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="chart-card">
                        <div class="chart-card-body">
                            <canvas id="riskChart" height="120"></canvas>
                        </div>
                        <div class="chart-card-footer">Risk Metrics</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <!-- Quick Trading Controls Card -->
                    <div class="trading-card">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-exchange-alt me-2"></i>Quick Trading
                            </h6>
                        </div>
                        <div class="card-body d-flex flex-column justify-content-between">
                            <div class="d-grid gap-2">
                                <button class="btn btn-success fw-bold" onclick="showBuyDialog()">
                                    <i class="fas fa-arrow-up me-2"></i> BUY
                                </button>
                                <button class="btn btn-danger fw-bold" onclick="showSellDialog()">
                                    <i class="fas fa-arrow-down me-2"></i> SELL
                                </button>
                                <button class="btn btn-warning fw-bold" onclick="toggleBot()">
                                    <i class="fas fa-robot me-2"></i> <span id="bot-status">START BOT</span>
                                </button>
                            </div>
                            <div class="mt-3 text-center">
                                <small style="opacity: 0.7;">
                                    <i class="fas fa-shield-alt me-1"></i>Live OKX Trading
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <hr class="section-divider my-5">

        <!-- SECTION 2: PORTFOLIO -->
        <section id="portfolio" class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-wallet me-2 text-info"></i>Portfolio Overview</h2>
                <button class="btn btn-outline-primary btn-sm" onclick="refreshPortfolioData()">
                    <i class="fas fa-sync-alt me-1"></i> Refresh
                </button>
            </div>

            <!-- Portfolio Summary KPIs -->
            <div class="row text-center mb-4">
                <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                    <div class="kpi-card bg-primary text-white shadow-sm">
                        <div class="kpi-icon">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div class="value" id="summary-total-value">$0.00</div>
                        <div class="label">Total Portfolio Value</div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                    <div class="kpi-card bg-info text-white shadow-sm">
                        <div class="kpi-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="value" id="summary-total-change">$0.00 (0.00%)</div>
                        <div class="label">Total Change</div>
                    </div>
                </div>
                <div class="col-lg-1 col-md-2 col-sm-4 mb-3">
                    <div class="kpi-card bg-success text-white shadow-sm">
                        <div class="kpi-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="value" id="summary-total-assets">0</div>
                        <div class="label">Assets</div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                    <div class="kpi-card bg-success text-white shadow-sm">
                        <div class="kpi-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="value">
                            <i class="fas fa-arrow-up me-1"></i>
                            <span id="summary-best-performer">N/A</span>
                            <small id="summary-best-performance" class="ms-2">+0.00%</small>
                        </div>
                        <div class="label">Best Performer</div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                    <div class="kpi-card bg-danger text-white shadow-sm">
                        <div class="kpi-icon">
                            <i class="fas fa-arrow-trend-down"></i>
                        </div>
                        <div class="value" id="summary-worst-performer">
                            <i class="fas fa-arrow-down me-1"></i><span>N/A</span>
                        </div>
                        <div class="label">Worst Performer</div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                    <div class="kpi-card bg-warning text-dark shadow-sm">
                        <div class="kpi-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="value" id="summary-cash-balance">$0.00</div>
                        <div class="label">Cash Balance</div>
                    </div>
                </div>
                <div class="col-lg-1 col-md-2 col-sm-4 mb-3">
                    <div class="kpi-card bg-dark text-white shadow-sm">
                        <div class="kpi-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="value" id="summary-win-rate">0%</div>
                        <div class="label">Win Rate</div>
                    </div>
                </div>
            </div>

            <!-- Portfolio Charts -->
            <div class="row g-3 mb-4">
                <div class="col-lg-8">
                    <div class="chart-card">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0">
                                <i class="fas fa-chart-area me-2"></i> Portfolio Value Over Time
                            </h6>
                            <small class="text-muted">Historical performance</small>
                        </div>
                        <canvas id="portfolioValueChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="chart-card">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0">
                                <i class="fas fa-chart-pie me-2"></i> Asset Allocation
                            </h6>
                            <small class="text-muted">Current breakdown</small>
                        </div>
                        <canvas id="allocationChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <hr class="section-divider my-5">

        <!-- SECTION 3: PERFORMANCE -->
        <section id="performance" class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-chart-bar me-2 text-success"></i>Performance Analytics</h2>
                <div class="d-flex gap-2">
                    <div class="btn-group btn-group-sm" role="group">
                        <button class="btn btn-outline-secondary" data-range="1M">1M</button>
                        <button class="btn btn-outline-secondary" data-range="3M">3M</button>
                        <button class="btn btn-outline-secondary" data-range="6M">6M</button>
                        <button class="btn btn-outline-secondary active" data-range="YTD">YTD</button>
                        <button class="btn btn-outline-secondary" data-range="1Y">1Y</button>
                    </div>
                    <button class="btn btn-primary btn-sm" onclick="refreshPerformanceData()">
                        <i class="fas fa-sync-alt me-1"></i> Refresh
                    </button>
                </div>
            </div>

            <!-- Performance KPIs -->
            <div class="row g-3 mb-4">
                <div class="col-6 col-md-3 col-xl-2">
                    <div class="kpi-card bg-primary text-white shadow-sm">
                        <div class="label">Total Invested</div>
                        <div class="value" id="perf-total-invested">$0.00</div>
                    </div>
                </div>
                <div class="col-6 col-md-3 col-xl-2">
                    <div class="kpi-card bg-info text-white shadow-sm">
                        <div class="label">Current Value</div>
                        <div class="value" id="perf-current-value">$0.00</div>
                    </div>
                </div>
                <div class="col-6 col-md-3 col-xl-2">
                    <div class="kpi-card bg-success text-white shadow-sm">
                        <div class="label">Total P&L</div>
                        <div class="value" id="perf-total-pnl">$0.00</div>
                    </div>
                </div>
                <div class="col-6 col-md-3 col-xl-2">
                    <div class="kpi-card bg-warning text-dark shadow-sm">
                        <div class="label">Overall Return</div>
                        <div class="value" id="perf-overall-return">0.00%</div>
                    </div>
                </div>
                <div class="col-6 col-md-3 col-xl-2">
                    <div class="kpi-card bg-secondary text-white shadow-sm">
                        <div class="label">Sharpe (ann.)</div>
                        <div class="value" id="perf-sharpe">0.00</div>
                    </div>
                </div>
                <div class="col-6 col-md-3 col-xl-2">
                    <div class="kpi-card bg-dark text-white shadow-sm">
                        <div class="label">Max Drawdown</div>
                        <div class="value" id="perf-maxdd">0.00%</div>
                    </div>
                </div>
            </div>

            <!-- Performance Charts -->
            <div class="row g-3 mb-4">
                <div class="col-lg-8">
                    <div class="chart-card">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0">
                                <i class="fas fa-chart-line me-2"></i> Equity Curve
                            </h6>
                            <small class="text-muted">Portfolio growth over time</small>
                        </div>
                        <canvas id="equityCurveChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="chart-card">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0">
                                <i class="fas fa-water me-2"></i> Drawdown
                            </h6>
                            <small class="text-muted">Risk analysis</small>
                        </div>
                        <canvas id="drawdownChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <hr class="section-divider my-5">

        <!-- SECTION 4: CURRENT HOLDINGS -->
        <section id="holdings" class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-coins me-2 text-warning"></i>Current Holdings</h2>
                <button class="btn btn-outline-primary btn-sm" onclick="refreshHoldingsData()">
                    <i class="fas fa-sync-alt me-1"></i> Refresh
                </button>
            </div>

            <!-- Holdings Table -->
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive table-responsive-400">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark sticky-top">
                                <tr>
                                    <th class="table-sortable" onclick="sortHoldingsTable(0)">Symbol <i class="fas fa-sort ms-1"></i></th>
                                    <th class="table-sortable" onclick="sortHoldingsTable(1)">Name <i class="fas fa-sort ms-1"></i></th>
                                    <th class="table-sortable" onclick="sortHoldingsTable(2)">Quantity <i class="fas fa-sort ms-1"></i></th>
                                    <th class="table-sortable" onclick="sortHoldingsTable(3)">Price <i class="fas fa-sort ms-1"></i></th>
                                    <th class="table-sortable" onclick="sortHoldingsTable(4)">Value <i class="fas fa-sort ms-1"></i></th>
                                    <th class="table-sortable" onclick="sortHoldingsTable(5)">Allocation % <i class="fas fa-sort ms-1"></i></th>
                                    <th class="table-sortable" onclick="sortHoldingsTable(6)">24h Change <i class="fas fa-sort ms-1"></i></th>
                                    <th class="table-sortable" onclick="sortHoldingsTable(7)">P&L <i class="fas fa-sort ms-1"></i></th>
                                </tr>
                            </thead>
                            <tbody id="holdings-table-body">
                                <tr><td colspan="8" class="text-center">Loading current holdings...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <hr class="section-divider my-5">

        <!-- SECTION 5: TRADES -->
        <section id="trades" class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-exchange-alt me-2 text-danger"></i>Recent Trades</h2>
                <div class="d-flex gap-2">
                    <select id="trades-timeframe" class="form-select form-select-sm" onchange="filterTradesByTimeframe()">
                        <option value="7d" selected>Last 7 days</option>
                        <option value="30d">Last 30 days</option>
                        <option value="90d">Last 90 days</option>
                        <option value="all">All trades</option>
                    </select>
                    <button class="btn btn-outline-primary btn-sm" onclick="refreshTradesData()">
                        <i class="fas fa-sync-alt me-1"></i> Refresh
                    </button>
                </div>
            </div>

            <!-- Trade Filters -->
            <div class="row mb-3">
                <div class="col-md-3">
                    <input type="text" id="trades-filter" class="form-control form-control-sm" placeholder="Filter by symbol..." oninput="filterTradesTable()">
                </div>
                <div class="col-md-3">
                    <select id="trades-action-filter" class="form-select form-select-sm" onchange="filterTradesTable()">
                        <option value="">All Actions</option>
                        <option value="BUY">Buy Only</option>
                        <option value="SELL">Sell Only</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select id="trades-pnl-filter" class="form-select form-select-sm" onchange="filterTradesTable()">
                        <option value="">All P&L</option>
                        <option value="positive">Profitable</option>
                        <option value="negative">Loss</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-outline-secondary btn-sm w-100" onclick="clearTradesFilters()">
                        <i class="fas fa-times me-1"></i> Clear Filters
                    </button>
                </div>
            </div>

            <!-- Trades Table -->
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive table-responsive-480">
                        <table class="table table-sm">
                            <thead class="table-dark sticky-top">
                                <tr>
                                    <th class="table-sortable" onclick="sortTradesTable(0)">Trade # <i class="fas fa-sort ms-1"></i></th>
                                    <th class="table-sortable" onclick="sortTradesTable(1)">Time <i class="fas fa-sort ms-1"></i></th>
                                    <th class="table-sortable" onclick="sortTradesTable(2)">Symbol <i class="fas fa-sort ms-1"></i></th>
                                    <th class="table-sortable" onclick="sortTradesTable(3)">Action <i class="fas fa-sort ms-1"></i></th>
                                    <th class="table-sortable" onclick="sortTradesTable(4)">Size <i class="fas fa-sort ms-1"></i></th>
                                    <th class="table-sortable" onclick="sortTradesTable(5)">Price <i class="fas fa-sort ms-1"></i></th>
                                    <th class="table-sortable" onclick="sortTradesTable(6)">P&L <i class="fas fa-sort ms-1"></i></th>
                                </tr>
                            </thead>
                            <tbody id="trades-table">
                                <tr><td colspan="7" class="text-center">Loading recent trades...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-3 mt-5">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-1"><small><strong>System Status & Info</strong></small></p>
                    <p class="mb-1 text-xs">
                        <i class="fas fa-server me-1"></i>
                        Server Uptime: <span id="footer-system-uptime">0s</span> |
                        <i class="fas fa-exchange-alt me-1"></i>
                        OKX: <span id="footer-okx-status">Connected</span> |
                        <i class="fas fa-code-branch me-1"></i>
                        Version: {{ version|default('dev') }}
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-1"><small><strong>Legal & Compliance</strong></small></p>
                    <p class="mb-0 text-xs">
                        © 2025 ARM Digital Enterprises. ATO compliant reporting system.
                        <strong>Disclaimer:</strong> High-risk trading platform for informational purposes.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='app.js') }}?v={{ cache_version|default(0) }}" defer></script>
    
    <!-- Unified Dashboard JS -->
    <script>
    // Smooth scrolling and navigation highlighting
    function scrollToSection(sectionId) {
        document.getElementById(sectionId).scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });
        
        // Update active nav pill
        document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
        document.querySelector(`[href="#${sectionId}"]`).classList.add('active');
    }

    // Auto-update active section based on scroll position
    window.addEventListener('scroll', function() {
        const sections = ['overview', 'portfolio', 'performance', 'holdings', 'trades'];
        const scrollPos = window.scrollY + 100;
        
        sections.forEach(section => {
            const element = document.getElementById(section);
            const navLink = document.querySelector(`[href="#${section}"]`);
            
            if (element.offsetTop <= scrollPos && element.offsetTop + element.offsetHeight > scrollPos) {
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                navLink.classList.add('active');
            }
        });
    });

    // Trading control functions
    function showBuyDialog() {
        const symbol = prompt("Enter symbol to buy (e.g., BTC-USDT):");
        if (!symbol) return;
        
        const amount = prompt("Enter USD amount to invest:");
        if (!amount || isNaN(amount)) return;
        
        if (confirm(`Buy $${amount} worth of ${symbol}?`)) {
            executeBuyOrder(symbol, parseFloat(amount));
        }
    }

    function showSellDialog() {
        const symbol = prompt("Enter symbol to sell (e.g., BTC-USDT):");
        if (!symbol) return;
        
        const percentage = prompt("Enter percentage to sell (1-100):");
        if (!percentage || isNaN(percentage) || percentage < 1 || percentage > 100) return;
        
        if (confirm(`Sell ${percentage}% of your ${symbol} position?`)) {
            executeSellOrder(symbol, parseFloat(percentage));
        }
    }

    function executeBuyOrder(symbol, amount) {
        fetch('/api/buy', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ symbol: symbol, amount: amount })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(`Buy order successful: ${data.message}`);
                // Refresh data
                if (typeof loadDashboardData === 'function') loadDashboardData();
                if (typeof loadHoldingsData === 'function') loadHoldingsData();
            } else {
                alert(`Buy order failed: ${data.error}`);
            }
        })
        .catch(error => {
            console.error('Buy order error:', error);
            alert('Buy order failed: Network error');
        });
    }

    function executeSellOrder(symbol, percentage) {
        fetch('/api/sell', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ symbol: symbol, percentage: percentage })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(`Sell order successful: ${data.message}`);
                // Refresh data
                if (typeof loadDashboardData === 'function') loadDashboardData();
                if (typeof loadHoldingsData === 'function') loadHoldingsData();
            } else {
                alert(`Sell order failed: ${data.error}`);
            }
        })
        .catch(error => {
            console.error('Sell order error:', error);
            alert('Sell order failed: Network error');
        });
    }

    function toggleBot() {
        fetch('/api/toggle-bot', {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const botStatus = document.getElementById('bot-status');
                const botToggleText = document.getElementById('bot-toggle-text');
                if (botStatus) botStatus.textContent = data.status;
                if (botToggleText) botToggleText.textContent = data.status;
                alert(`Bot ${data.status}`);
            } else {
                alert(`Bot toggle failed: ${data.error}`);
            }
        })
        .catch(error => {
            console.error('Bot toggle error:', error);
            alert('Bot toggle failed: Network error');
        });
    }

    function executeRebalance() {
        if (confirm('Execute portfolio rebalance? This will adjust all positions.')) {
            fetch('/api/rebalance', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`Rebalance successful: ${data.message}`);
                    // Refresh all data
                    if (typeof loadDashboardData === 'function') loadDashboardData();
                    if (typeof loadHoldingsData === 'function') loadHoldingsData();
                } else {
                    alert(`Rebalance failed: ${data.error}`);
                }
            })
            .catch(error => {
                console.error('Rebalance error:', error);
                alert('Rebalance failed: Network error');
            });
        }
    }

    // Initialize all data loading when page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Load all sections data
        if (typeof loadDashboardData === 'function') loadDashboardData();
        if (typeof loadPortfolioData === 'function') loadPortfolioData();
        if (typeof loadPerformanceData === 'function') loadPerformanceData();
        if (typeof loadHoldingsData === 'function') loadHoldingsData();
        if (typeof loadTradesData === 'function') loadTradesData();
        
        // Start auto-refresh intervals
        setInterval(function() {
            if (typeof loadDashboardData === 'function') loadDashboardData();
        }, 30000); // Refresh overview every 30s
        
        setInterval(function() {
            if (typeof loadHoldingsData === 'function') loadHoldingsData();
        }, 60000); // Refresh holdings every 60s
    });
    </script>
</body>
</html>